<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fotka + GPS odesílání</title>
</head>
<body>
<h1>Fotka + GPS odesílání</h1>

<div id="status">Čekám na povolení kamery a polohy...</div>
<video id="video" autoplay playsinline width="320" height="240" style="border:1px solid black;"></video>

<script>
const statusDiv = document.getElementById("status");
const video = document.getElementById("video");

async function start() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
  } catch(e) {
    statusDiv.textContent = "Kamera nebyla povolena nebo není dostupná.";
    return;
  }

  if (!("geolocation" in navigator)) {
    statusDiv.textContent = "GPS není dostupná v tomto prohlížeči.";
    return;
  }

  navigator.geolocation.getCurrentPosition(
    pos => {
      statusDiv.textContent = "Povolení získáno, začínám fotit a posílat data...";
      captureAndSend(pos.coords.latitude, pos.coords.longitude);
    },
    err => {
      statusDiv.textContent = "GPS nebyla povolena nebo není dostupná.";
    }
  );
}

function captureAndSend(lat, lon) {
  const canvas = document.createElement("canvas");
  canvas.width = video.videoWidth || 320;
  canvas.height = video.videoHeight || 240;
  const ctx = canvas.getContext("2d");

  setInterval(() => {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imageData = canvas.toDataURL("image/png");

    fetch("https://tvuj-server.herokuapp.com/upload", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        lat: lat,
        lon: lon,
        image: imageData
      })
    });
  }, 5000);
}

start();
</script>

</body>
</html>
